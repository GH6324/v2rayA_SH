# 🚀 Xray-core + v2rayA 全能管理脚本

> **一键部署、智能版本探测、平滑升级、多架构支持**

这是一个专为 **Debian / Ubuntu / CentOS / Alpine** 等 Linux 系统设计的 Shell 脚本。它能够自动化部署和管理最新版本的 [Xray-core](https://github.com/XTLS/Xray-core) 和 [v2rayA](https://github.com/v2rayA/v2rayA)。

脚本解决了常见的 API 限制问题、并内置了智能的兜底机制，确保在各种网络环境下都能安装成功。

如遇问题，请在 [Issues](https://github.com/GH6324/v2rayA_SH/issues/new) 反馈。

# ⭐ 如果觉得有帮助，点个 Star 吧！

💖 **你的支持是我们更新的动力！**  
动动发财的小手，给项目点个 [🌟 Star](https://github.com/GH6324/v2rayA_SH) 吧！谢谢！ 🎈🎈🎈  
-----


## ✨ 核心特性

| 功能 | 说明 |
| :--- | :--- |
| 📊 **版本看板** | 启动时自动对比 **本地版本** 与 **GitHub 最新版本**，直观显示更新状态。 |
| 🔌 **端口自定义** | 安装时可自由指定 v2rayA 面板端口（默认 2017），支持后期一键修改。 |
| 🗑️ **一键卸载** | 提供彻底卸载功能，自动清理二进制文件、配置文件及系统服务。 |
| 🛠️ **双重探测** | 结合 GitHub API 与 HTTP 重定向机制，解决 API 速率限制导致的检测失败问题。 |
| 🌍 **智能加速** | 内置 `gh-proxy` 代理节点，确保国内/海外服务器均能高速下载。 |
| 🛡️ **防火墙管理** | 自动识别 UFW / FirewallD / iptables 并放行指定端口。 |
| ⚙️ **多系统支持** | 完美支持 `Systemd` (主流 Linux) 和 `OpenRC` (Alpine Linux)。 |

-----

## 📥 安装与使用

### 快速运行

直接运行一键脚本即可：

```bash
bash <(curl -Ls https://gh-proxy.com/raw.githubusercontent.com/GH6324/v2rayA_SH/main/install.sh)
```

-----

## 🎮 功能菜单说明

运行脚本后，您将看到如下交互式面板：

```text
====================================================
      Xray-core + v2rayA 管理脚本     
====================================================
 系统架构: x86_64  |  Init: systemd  |  端口: 2017
----------------------------------------------------
组件       本地版本         最新版本         状态      
----------------------------------------------------
Xray       1.8.4            v1.8.6           [可更新]
v2rayA     2.2.4            v2.2.6           [可更新]
----------------------------------------------------
  1. 安装 / 重置 (支持自定义端口)
  2. 更新 Xray-Core
  3. 更新 v2rayA
  4. 一键更新所有 (保持现有端口配置)
  5. 修改监听端口 (不重装)
  6. 卸载 Xray 和 v2rayA
  0. 退出
----------------------------------------------------
```

### 详细选项解读：

  * **1. 安装 / 重置**：
      * 适用于全新安装，或系统环境损坏需要重置时。
      * **新特性**：安装过程中会询问监听端口（默认为 2017），你可以输入任意未被占用的端口（1-65535）。
  * **2/3. 单独更新**：
      * 仅更新 Xray 内核或 v2rayA 面板，**不影响** 现有的配置文件和节点数据。
  * **4. 一键更新所有**：
      * 同时检测并更新两个组件，保持现有端口配置不变。
  * **5. 修改监听端口**：
      * 无需重装，直接修改面板访问端口。
      * 脚本会自动修改 Service 文件并重启服务，同时尝试放行新端口的防火墙。
  * **6. 卸载**：
      * 停止服务、删除所有二进制文件、清理配置文件、移除开机自启。

-----

## 📂 文件路径速查

| 组件 | 类型 | 路径 |
| :--- | :--- | :--- |
| **Xray** | 二进制文件 | `/usr/local/bin/xray` |
| **Xray** | 资源文件 (GeoIP/Site) | `/usr/local/share/xray/` |
| **v2rayA** | 二进制文件 | `/usr/local/bin/v2raya` |
| **v2rayA** | **配置文件目录** | `/usr/local/etc/v2raya/` |
| **Log** | 运行日志 | `/var/log/v2raya.log` |
| **Service** | 服务配置 | `/etc/systemd/system/v2raya.service` |

-----

## ❓ 常见问题 (FAQ)

#### Q1: 修改端口后无法访问？

1.  **云服务商安全组**：脚本只能自动配置系统内部的防火墙（如 UFW）。如果你使用的是阿里云、腾讯云、AWS 等，**必须**前往云控制台的安全组设置，手动放行你设定的端口（TCP）。
2.  **端口冲突**：确保你设置的端口没有被其他软件（如 Nginx 80/443）占用。
3.	**NAT机器**：请自行映射端口或使用商家给的端口范围
#### Q2: 状态显示 "API 速率受限"？

GitHub 对 API 请求有严格限制。如果出现此提示，脚本会自动切换到 **HTTP 重定向探测模式**，或者使用内置的 **兜底版本** 进行安装，确保安装过程不会中断。

#### Q3: 如何查看运行日志？

如果面板无法启动，可以通过以下命令排查错误：

```bash
# 查看实时日志
tail -f /var/log/v2raya.log

# 或者查看系统服务状态
systemctl status v2raya
```

-----

## ⚠️ 免责声明

  * 本脚本仅供技术交流与服务器管理研究使用。
  * 请遵守当地法律法规，切勿将本脚本用于非法用途。
  * 使用本脚本造成的任何数据丢失或系统问题，作者不承担责任。建议在生产环境操作前备份重要数据。

-----